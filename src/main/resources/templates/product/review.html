<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">

<meta charset="UTF-8">
<title>ìƒí’ˆë¦¬ë·°</title>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"
        integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
      integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm"
      crossorigin="anonymous">
<script src="https://code.jquery.com/jquery-3.6.0.min.js"
        integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
<style>

    h1,
    h5 {
        display: inline;
    }

    .info {
        margin-top: 20px;
        margin-bottom: 20px;
    }

    .review {
        text-align: center;
    }

    #myform fieldset {
        display: inline-block; /* í•˜ìœ„ ë³„ì  ì´ë¯¸ì§€ë“¤ì´ ìˆëŠ” ì˜ì—­ë§Œ ìë¦¬ë¥¼ ì°¨ì§€í•¨.*/
        border: 0; /* í•„ë“œì…‹ í…Œë‘ë¦¬ ì œê±° */
    }

    #myform input[type=radio] {
        display: none; /* ë¼ë””ì˜¤ë°•ìŠ¤ ê°ì¶¤ */
    }

    #myform label {
        font-size: 3em; /* ì´ëª¨ì§€ í¬ê¸° */
        color: transparent; /* ê¸°ì¡´ ì´ëª¨ì§€ ì»¬ëŸ¬ ì œê±° */
        text-shadow: 0 0 0 #f0f0f0; /* ìƒˆ ì´ëª¨ì§€ ìƒ‰ìƒ ë¶€ì—¬ */
    }

    #myform label:hover {
        text-shadow: 0 0 0 #ffc107; /* ë§ˆìš°ìŠ¤ í˜¸ë²„ */
    }

    #myform label:hover ~ label {
        text-shadow: 0 0 0 #ffc107; /* ë§ˆìš°ìŠ¤ í˜¸ë²„ ë’¤ì—ì˜¤ëŠ” ì´ëª¨ì§€ë“¤ */
    }

    #myform fieldset {
        display: inline-block; /* í•˜ìœ„ ë³„ì  ì´ë¯¸ì§€ë“¤ì´ ìˆëŠ” ì˜ì—­ë§Œ ìë¦¬ë¥¼ ì°¨ì§€í•¨.*/
        direction: rtl; /* ì´ëª¨ì§€ ìˆœì„œ ë°˜ì „ */
        border: 0; /* í•„ë“œì…‹ í…Œë‘ë¦¬ ì œê±° */
    }

    #myform fieldset legend {
        text-align: left;
    }

    #myform input[type=radio]:checked ~ label {
        text-shadow: 0 0 0 #ffc107; /* ë§ˆìš°ìŠ¤ í´ë¦­ ì²´í¬ */
    }
</style>

<th:block th:replace="~{/layout/basic::setContent(~{this::content})}">
    <th:block th:fragment="content">
        <input type="hidden" id="member" th:value="${principal.memberCode}">
        <input type="hidden" id="product" th:value="${product.productCode}">
        <input type="hidden" id="commentTitle" th:value="${product.productName}">

        <div class="container">
            <div class="info">
                <form id="form" enctype="multipart/form-data">
                    <h1>ìƒí’ˆë¦¬ë·°</h1>
                    <p>ì†Œì¤‘í•œ ë¦¬ë·° ì‘ì„± ê°ì‚¬ë“œë¦½ë‹ˆë‹¤ğŸ˜ŠğŸ˜Š</p>
                    <div class="input-group mb-3">
                        <div class="input-group-prepend">
                            <span class="input-group-text">ìƒí’ˆëª…</span>
                        </div>
                        <input type="text" class="form-control"
                               th:placeholder="${product.productName}" disabled>
                    </div>
                    <div class="input-group mb-3">
                        <div class="input-group-prepend">
                            <span class="input-group-text">í›„ê¸°ì‘ì„±</span>
                        </div>
                        <textarea class="form-control" id="commentContent"
                                  cols="30"
                                  rows="5" placeholder="160ìê¹Œì§€ ì…ë ¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤."></textarea>
                    </div>
                    <div class="input-group mb-3">
                        <div class="input-group-prepend">
                            <span class="input-group-text">í›„ê¸°ì‚¬ì§„</span>
                        </div>
                        <input type="file" class="form-control" name="file" id="file">
                    </div>
                    <div id="myform">
                        <fieldset>
                            <legend>ë³„ì </legend>
                            <input type="radio" name="rating" value="5" id="star1"><label for="star1">â­</label>
                            <input type="radio" name="rating" value="4" id="star2"><label for="star2">â­</label>
                            <input type="radio" name="rating" value="3" id="star3"><label for="star3">â­</label>
                            <input type="radio" name="rating" value="2" id="star4"><label for="star4">â­</label>
                            <input type="radio" name="rating" value="1" id="star5"><label for="star5">â­</label>
                        </fieldset>
                    </div>
                    <div class="review">
                        <button id="reviewOk" type="button" class="btn btn-primary">ë¦¬ë·° ì‘ì„±ì™„ë£Œ</button>
                    </div>
                </form>
            </div>
        </div>
        <script th:inline="javascript">
            $(() => {
                let commentHoroscope = 0
                const writingDate = new Date(); //ì‘ì„±ì¼ì
                const commentViews = 0; //ì¡°íšŒìˆ˜
                const commentRecommend = 0; //ì¶”ì²œìˆ˜
                const member = $('#member').val(); //ë§´ë²„ ê°ì²´
                const bulletinBoard = 3; //ê²Œì‹œê¸€ìœ í˜• ê°ì²´
                const product =$('#product').val(); //ìƒí’ˆì½”ë“œ
                $('#myform input').on('change', function () {
                    console.log('ë³„ì  :: ' + $('input[name=rating]:checked', '#myform').val());
                    commentHoroscope = $('input[name=rating]:checked', '#myform').val(); //ë³„ì 
                }),
                    $('#reviewOk').on('click', () => {
                        console.log(commentHoroscope + " :: commentHoroscope\n" +
                            $('#commentTitle').val() + " :: commentTitle\n" +
                            $('#commentContent').val() + " :: commentContent\n" +
                            writingDate + " :: writingDate\n" +
                            commentViews + " :: commentViews\n" +
                            commentRecommend + " :: commentRecommend\n" +
                            member + " :: member\n" +
                            bulletinBoard + " :: bulletinBoard\n")

                        const data = {
                            commentTitle:$('#commentTitle').val(),
                            commentContent:$('#commentContent').val(),
                            writingDate:writingDate,
                            commentViews:commentViews,
                            commentRecommend:commentRecommend,
                            commentHoroscope:commentHoroscope,
                            bulletinBoard: {
                                bulletinBoardCode: bulletinBoard
                            },
                            product: {
                                productCode: product
                            },
                            member:{
                                memberCode:member
                            }
                        }
                        const path = '/api/product/reviews';
                        const form = $('#form')[0];
                        const formData = new FormData(form);
                        formData.append('file', $('#file'));
                        formData.append('key', new Blob([JSON.stringify(data)], {type: "application/json"}));
                        $.ajax({
                            url: path,
                            type: 'POST',
                            processData: false,
                            contentType: false,
                            data: formData,
                            success: function (data) {
                                if(data == "ok"){
                                    alert('í›„ê¸°ì‘ì„±ì™„ë£Œ')
                                    window.location.href = '/product/orderlist?memberCode='+member;
                                }
                                else if(data == "no"){
                                    alert('ì´ë¯¸ì‘ì„±í•œ ìƒí’ˆì˜ í›„ê¸°ì…ë‹ˆë‹¤')
                                    window.location.href = '/product/orderlist?memberCode='+member;
                                }
                            }
                        }).fail((error) => {
                            alert((error));
                        })
                    });
            })
        </script>
    </th:block>
</th:block>
</html>