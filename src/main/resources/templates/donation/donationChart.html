<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.w3.org/1999/xhtml">
        <head>
            <meta charset="UTF-8">
            <title>후원 차트</title>
            <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
                  rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3"
                  crossorigin="anonymous">

            <!--    <script src="/js/jquery.twbsPagination.js"></script>-->
            <script src="https://code.jquery.com/jquery-3.5.1.min.js"
                    integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
        </head>
        <a sec:authorize="isAuthenticated()">
            <body>
            <th:block th:replace="~{/layout/basic::setContent(~{this::content})}">
                <th:block th:fragment="content">
                <h2>의류 후원 현황</h2>
            <table border="1px">
                <div id="main">
                    <thead>
                    <tr>
                        <th scope="col">의류후원코드</th>
                        <th scope="col">의류량</th>
                        <th scope="col">수거날짜</th>
                        <th scope="col">수거지역</th>
                        <th scope="col">기부영수증발행여부</th>
                        <th scope="col">기부영수증신청여부</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="cloth :${cloths}">
                        <th th:text="${cloth.clothingSponsorCode}" id="clothingSponsorCode" th:value="${cloth.clothingSponsorCode}"></th>
                        <!--<th th:text="${cloth.MemberCode}"></th>-->
                        <th th:text="${cloth.amount}"></th>
                        <th th:text="${cloth.pickupDate}"></th>
                        <th th:text="${cloth.pickupArea}"></th>
                        <th th:text="${cloth.issueStatus}"></th>
                        <th th:text="${cloth.appStatus}"></th>
                        <br>
                        <th>
                            <button><a style="text-decoration-line: none;" id="modify"
                                       th:href="@{/donation/clothesManage(id=${cloth.clothingSponsorCode})}">의류후원관리</a></button>
                        </th>
                    </tr>
                    </tbody>
                </div>
            </table>
            <h2>금전 후원 현황</h2>
            <table border="1px">
                <div id="main2">
                    <thead>
                    <tr>
                        <th scope="col">금전후원코드</th>
                        <th scope="col">후원금액</th>
                        <th scope="col">후원날짜</th>
                        <th scope="col">후원유형</th>
                        <th scope="col">기부영수증발행여부</th>
                        <th scope="col">기부영수증신청여부</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="financial:${financials}">
                        <th th:text="${financial.financialSupportCode}" id="financialSupportCode" th:value="${financial.financialSupportCode}"></th>
                        <!--            <th th:text="${financial.memberCode}"></th>-->
                        <!--        <th th:text="${cloth.MemberCode}"></th>-->
                        <th th:text="${financial.financialAmount}"></th>
                        <th th:text="${financial.financialDate}"></th>
                        <th th:text="${financial.financialType}"></th>
                        <th th:text="${financial.statusIssue}"></th>
                        <th th:text="${financial.statusApp}"></th>
                        <br>
                        <th>
                            <button><a style="text-decoration-line: none;" id="modify2"
                                       th:href="@{/donation/financialManage(id=${financial.financialSupportCode})}">금전후원관리</a></button>
                        </th>
                    </tr>
                    </tbody>
                </div>
            </table>
            <button th:onclick="|location.href='@{/donation}'|">후원메인으로</button>
            <button id="makeChart" class="btn btn-outline-success" type="submit">차트 보이기</button>
    </th:block>
</th:block>

            <div class="row">
                <div class="container">
                    <div style="margin-top:20px; margin-left:80px">
                        <select name="selectMonth" id="selectMonth">
                            <option value="1">JAN</option>
                            <option value="2">FEB</option>
                            <option value="3">MAR</option>
                            <option value="4">APR</option>
                            <option value="5">MAY</option>
                            <option value="6">JUN</option>
                            <option value="7">JUL</option>
                            <option value="8">AUG</option>
                            <option value="9">SEP</option>
                            <option value="10">OCT</option>
                            <option value="11">NOV</option>
                            <option value="12">DEC</option>
                        </select>
                        <button id="btn">보기</button>
                    </div>
                </div>
               <div id="graph" style="width: 80%; margin: 30px;">
                    <div>
                        <canvas id="canvas" height="350" width="600"></canvas>
                    </div>
                </div>
            </div>
            </div>

            <script>
                $(document).ready(function() {

                    var chartLabels = [];
                    var chartData = [];
                    var month = "";

                    var cooContractNo = '<c:out value="${no}">';

                    function createChart() {
                        var ctx = document.getElementById("canvas").getContext("2d");
                        LineChartDemo = Chart.Line(ctx, {
                            data : lineChartData,
                            options : {
                                scales : {
                                    yAxes : [{
                                        ticks : {
                                            beginAtZero : true
                                        }
                                    }]
                                }
                            }
                        });
                    }

                    // selectList로 월을 선택해서 ajax로 받기
                    $('#selectMonth').change(function() {
                        var changeMonth = $('#selectMonth option:selected').val();
                        month = changeMonth;
                        console.log('month' + month);
                    });

                    // 버튼을 클릭하면 차트가 그려짐
                    $('#makeChart').click(function(){

                        chartLabels = [];
                        chartData = [];

                        //getJson으로 데이터
                        $.getJSON("./getDailyVisitor", {
                            cooContractNo: cooContractNo,
                            month: month
                        }, function(data) {
                            $.each(data, function(key, value) {
                                chartLabels.push(value.statsDate);
                                chartData.push(value.statsAmount);
                            });

                            lineChartData = {
                                labels : chartLabels,
                                datasets : [{
                                    label : "일별 방문자 수",
                                    backgroundColor : "#bfdaf9",
                                    borderColor : "#80b6f4",
                                    pointBorderColor : "#80b6f4",
                                    pointBackgroundColor : "#80b6f4",
                                    pointHoverBackgroundColor : "#80b6f4",
                                    pointHoverBorderColor : "80b6f4",
                                    fill : false,
                                    borderWidth : 4,
                                    data : chartData
                                }]
                            }
                            createChart();
                        });

                    })

                })
            </script>
            </body>
        </a>


</html>